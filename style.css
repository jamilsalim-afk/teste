<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SGH - IFRO | Gestão 2025-2030</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    
    <style>
        :root { 
            --if-verde: #32a041; 
            --if-vermelho: #c31e24; 
            --if-branco: #ffffff;
            --if-cinza-claro: #f4f4f4;
            --if-cinza-escuro: #666666;
            --sidebar-dark: #1e272e;
            --azul-acao: #2980b9;
            --relevo-shadow: 6px 6px 12px #b8b9be, -6px -6px 12px #ffffff;
        }

        body { 
            font-family: 'Segoe UI', Roboto, sans-serif; 
            margin: 0; 
            display: flex; 
            background: var(--if-cinza-claro); 
            overflow: hidden; 
        }
        
        /* Sidebar Profissional */
        .sidebar { 
            width: 280px; 
            height: 100vh; 
            background: var(--sidebar-dark); 
            color: white; 
            padding: 20px; 
            box-sizing: border-box; 
            box-shadow: 4px 0 10px rgba(0,0,0,0.3);
            z-index: 10;
        }

        /* Logo em Alto Relevo */
        .logo-area { 
            text-align: center; 
            background: var(--if-branco);
            padding: 20px 10px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: var(--relevo-shadow); /* Efeito Neomorfismo */
            border-bottom: 5px solid var(--if-verde);
        }

        .logo-area h2 { 
            color: var(--if-verde); 
            margin: 10px 0 0 0; 
            font-size: 1.5rem;
            text-shadow: 1px 1px 0px #fff;
        }

        .logo-area .if-sub {
            color: var(--if-vermelho);
            font-weight: bold;
            font-size: 0.8rem;
            letter-spacing: 2px;
        }

        .ano-seletor { 
            width: 100%; 
            padding: 10px; 
            margin-top: 15px;
            background: #f8f9fa; 
            color: var(--sidebar-dark); 
            border: 1px solid #ddd; 
            border-radius: 8px; 
            font-weight: bold; 
            cursor: pointer;
        }

        /* Navegação */
        .menu-nav button { 
            width: 100%; 
            padding: 14px; 
            margin: 5px 0; 
            background: transparent; 
            border: none; 
            color: #d1d8e0; 
            text-align: left; 
            cursor: pointer; 
            transition: all 0.3s ease; 
            border-radius: 8px;
            font-size: 0.95rem;
        }

        .menu-nav button:hover, .menu-nav button.active { 
            background: var(--if-verde); 
            color: white; 
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transform: translateX(5px);
        }

        /* Área Principal e Cards */
        .main-content { flex: 1; height: 100vh; overflow-y: auto; padding: 40px; box-sizing: border-box; }
        
        .card { 
            background: white; 
            padding: 30px; 
            border-radius: 20px; 
            box-shadow: var(--relevo-shadow); 
            margin-bottom: 30px; 
            border-left: 8px solid var(--if-verde);
        }

        h3 { color: var(--if-verde); border-bottom: 2px solid #eee; padding-bottom: 10px; }

        /* Formulários Customizados */
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 25px; }
        
        input, select { 
            padding: 12px; 
            border: 1px solid #ddd; 
            border-radius: 10px; 
            background: #fafafa;
            transition: 0.3s;
        }

        input:focus { border-color: var(--if-verde); outline: none; box-shadow: 0 0 5px rgba(50,160,65,0.2); }

        /* Botões com Estilo IFRO */
        .btn-verde { 
            background: var(--if-verde); 
            color: white; 
            border: none; 
            padding: 14px 25px; 
            cursor: pointer; 
            border-radius: 10px; 
            font-weight: bold; 
            text-transform: uppercase;
            box-shadow: 0 4px 0px #267a32;
            transition: 0.2s;
        }

        .btn-verde:active { transform: translateY(3px); box-shadow: 0 1px 0px #267a32; }

        .btn-azul { 
            background: var(--azul-acao); 
            color: white; 
            border: none; 
            padding: 12px 20px; 
            cursor: pointer; 
            border-radius: 8px; 
            transition: 0.3s;
        }

        /* Grades e Tabelas */
        .excel-table { width: 100%; border-collapse: separate; border-spacing: 0; border-radius: 10px; overflow: hidden; box-shadow: 0 0 10px rgba(0,0,0,0.05); }
        .excel-table th { background: var(--if-verde); color: white; padding: 12px; font-weight: 500; }
        .excel-table td { border: 1px solid #eee; background: white; }
        .h-label { background: #f9f9f9; color: var(--if-verde); font-weight: bold; }
    </style>
</head>
<body>

<aside class="sidebar no-print">
    <div class="logo-container">
        <svg width="60" height="60" viewBox="0 0 100 100">
            <circle cx="25" cy="25" r="15" fill="#32a041"/>
            <rect x="50" y="10" width="20" height="20" fill="#32a041"/>
            <rect x="75" y="10" width="20" height="20" fill="#32a041"/>
            <rect x="50" y="35" width="20" height="20" fill="#32a041"/>
            <rect x="75" y="35" width="20" height="20" fill="#c31e24"/>
        </svg>
        <h2>SGH-IFRO</h2>
        <span></span>
        <div style="margin-top: 15px;">
            <select id="global-ano" class="ano-seletor" onchange="trocarAno()">
                <option value="2025">2025</option>
                <option value="2026" selected>2026</option>
                <option value="2027">2027</option>
                <option value="2028">2028</option>
                <option value="2029">2029</option>
                <option value="2030">2030</option>
        </select>
    </div>
    <nav class="menu-nav" id="main-nav">
        <button onclick="showTab(0)">1. Instituição</button>
        <button onclick="showTab(1)">2. Professores</button>
        <button onclick="showTab(2)">3. Turmas</button>
        <button onclick="showTab(3)">4. Disciplinas</button>
        <button onclick="showTab(4)">5. Vinculação</button>
        <button onclick="showTab(5)">6. Horário Base Téc.</button>
        <button onclick="showTab(6)">7. Horário Base Sup.</button>
        <button onclick="showTab(7)">8. Semanal Técnico</button>
        <button onclick="showTab(8)">9. Semanal Superior</button>
        <button onclick="showTab(9)">10. Relatórios</button>
    </nav>
</aside>

<main class="main-content">
<section id="aba-home" class="tab-content">
    <div class="card" style="text-align: center; padding: 60px;">
        <h1 style="color: var(--if-verde); font-size: 2.5em; margin-bottom: 10px;">Sistema de Gestão de Horários</h1>
        <p style="font-size: 1.2em; color: var(--if-cinza);">Instituto Federal de Educação, Ciência e Tecnologia de Rondônia</p>
        <div style="margin: 40px auto; width: 150px; height: 150px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 10px 10px 20px #bebebe, -10px -10px 20px #ffffff;">
             <strong style="color: var(--if-verde); font-size: 3em;">IF</strong>
        </div>
        <p>Utilize o menu lateral para iniciar os cadastros do ano de <strong id="display-ano">2026</strong>.</p>
    </div>
</section>
    <section id="aba-0" class="tab-content">
        <div class="card">
            <h3>1. DADOS DA INSTITUIÇÃO</h3>
            <div class="form-grid">
                <input type="text" id="inst-nome" placeholder="A - Nome da Instituição">
                <input type="text" id="inst-setor" placeholder="B - Setor">
                <input type="text" id="inst-end" placeholder="C - Endereço">
                <input type="text" id="inst-tel" placeholder="D - Telefone">
            </div>
            <div class="form-grid">
                <fieldset><legend>E - Calendário Técnico (Anual)</legend>
                    Início: <input type="date" id="cal-tec-ini"> Fim: <input type="date" id="cal-tec-fim">
                    Férias: <input type="date" id="cal-tec-v-ini"> a <input type="date" id="cal-tec-v-fim">
                </fieldset>
                <fieldset><legend>F - Calendário Superior (Semestral)</legend>
                    S1: <input type="date" id="cal-sup1-ini"> a <input type="date" id="cal-sup1-fim"><br>
                    S2: <input type="date" id="cal-sup2-ini"> a <input type="date" id="cal-sup2-fim">
                </fieldset>
            </div>
            <div class="form-grid">
                <div class="card-mini">
                    <h4>G - Feriados</h4>
                    <input type="date" id="fer-data"> <input type="text" id="fer-nome" placeholder="Feriado">
                    <button class="btn-azul" onclick="addItem('feriados')">Adicionar</button>
                    <div id="lista-feriados"></div>
                </div>
                <div class="card-mini">
                    <h4>H - Sábados Letivos</h4>
                    <input type="date" id="sab-data">
                    <select id="sab-tipo"><option value="Tecnico">Técnico</option><option value="Superior">Superior</option></select>
                    <button class="btn-azul" onclick="addItem('sabados')">Adicionar</button>
                    <div id="lista-sabados"></div>
                </div>
            </div>
            <button class="btn-verde" onclick="salvarGeral()">I - SALVAR DADOS</button>
        </div>
    </section>

    <section id="aba-1" class="tab-content hidden">
        <div class="card">
            <h3>2. CADASTRO DE PROFESSORES</h3>
            <div class="form-grid">
                <input type="text" id="p-nome" placeholder="Nome">
                <input type="text" id="p-siape" placeholder="SIAPE">
                <select id="p-sit"><option>EFETIVO</option><option>SUBSTITUTO</option><option>CEDIDO</option></select>
                <select id="p-ch"><option value="DE">DE</option><option value="40">40 HORAS</option><option value="20">20 HORAS</option></select>
                <div>PGD: <input type="checkbox" id="p-pgd-check" onchange="document.getElementById('p-pgd-val').disabled = !this.checked">
                <input type="number" id="p-pgd-val" placeholder="%" style="width:70px" disabled></div>
            </div>
            <h4>F - MATRIZ DE RESTRIÇÕES (CHECKBOX)</h4>
            <table class="excel-table rest-table">
                <thead><tr><th>Opção / Dia</th><th>SEG</th><th>TER</th><th>QUA</th><th>QUI</th><th>SEX</th></tr></thead>
                <tbody id="p-matriz-corpo"></tbody>
            </table>
            <h4>G - DIAS DE PRD</h4>
            <div class="form-grid">
                <select id="p-prd1"><option value="">Turno PRD 1</option><option>Segunda-Manhã</option><option>Segunda-Tarde</option><option>Terça-Manhã</option></select>
                <select id="p-prd2"><option value="">Turno PRD 2</option><option>Segunda-Manhã</option><option>Segunda-Tarde</option></select>
            </div>
            <button class="btn-verde" onclick="salvarProfessor()">H - SALVAR PROFESSOR</button>
            <div id="p-lista" style="margin-top:20px"></div>
        </div>
    </section>

    <section id="aba-2" class="tab-content hidden">
        <div class="card">
            <h3>3. TURMAS</h3>
            <div class="form-grid">
                <input type="text" id="t-nome" placeholder="Nome da Turma">
                <select id="t-sit"><option value="Tecnico">TÉCNICO</option><option value="Superior">SUPERIOR</option></select>
                <input type="text" id="t-sala" placeholder="Sala">
            </div>
            <button class="btn-verde" onclick="salvarTurma()">D - SALVAR TURMA</button>
            <div id="t-lista"></div>
        </div>
    </section>

    <section id="aba-3" class="tab-content hidden">
        <div class="card">
            <h3>4. DISCIPLINAS</h3>
            <div class="form-grid">
                <input type="text" id="d-nome" placeholder="Nome da Disciplina">
                <select id="d-sit"><option value="Tecnico">TÉCNICO</option><option value="Superior">SUPERIOR</option></select>
            </div>
            <button class="btn-verde" onclick="salvarDisciplina()">C - SALVAR DISCIPLINA</button>
            <div id="d-lista"></div>
        </div>
    </section>

    <section id="aba-4" class="tab-content hidden">
        <div class="card">
            <h3>5. VINCULAÇÃO PROFESSOR / TURMA / DISCIPLINA</h3>
            <div class="form-grid">
                <select id="v-prof"></select><select id="v-turma" onchange="gerarOpcoesAulas()"></select>
                <select id="v-disc"></select><input type="number" id="v-ch" placeholder="CH Total" onchange="gerarOpcoesAulas()">
            </div>
            <div class="form-grid">
                <select id="v-opcoes"></select>
                <div>União? <input type="checkbox" id="v-uniao-check" onchange="document.getElementById('v-uniao-turma').style.display = this.checked ? 'block' : 'none'">
                <select id="v-uniao-turma" style="display:none; margin-top:5px"></select></div>
            </div>
            <button class="btn-verde" onclick="salvarVinc()">G - SALVAR VÍNCULO</button>
            <div id="v-lista"></div>
        </div>
    </section>

    <section id="aba-5" class="tab-content hidden">
        <div class="card"><h3>6. HORÁRIO BASE TÉCNICO</h3><div id="grade-base-tec"></div><button class="btn-verde">SALVAR VERSÃO BASE</button></div>
    </section>
    <section id="aba-6" class="tab-content hidden">
        <div class="card"><h3>7. HORÁRIO BASE SUPERIOR</h3><div id="grade-base-sup"></div><button class="btn-verde">SALVAR VERSÃO BASE</button></div>
    </section>

    <section id="aba-7" class="tab-content hidden">
        <div class="card">
            <h3>8. HORÁRIO SEMANAL TÉCNICO</h3>
            <div class="form-grid"><input type="date" id="data-sem-tec"> <button class="btn-azul">IMPORTAR DO BASE</button></div>
            <div id="grade-sem-tec"></div>
        </div>
    </section>
    <section id="aba-8" class="tab-content hidden">
        <div class="card">
            <h3>9. HORÁRIO SEMANAL SUPERIOR</h3>
            <div class="form-grid"><input type="date" id="data-sem-sup"> <button class="btn-azul">IMPORTAR DO BASE</button></div>
            <div id="grade-sem-sup"></div>
        </div>
    </section>

    <section id="aba-9" class="tab-content hidden">
        <div class="card">
            <h3>10. GERAÇÃO DE RELATÓRIOS</h3>
            <div class="form-grid">
                <button class="btn-azul" onclick="alert('Exportando Relatório por Disciplina...')">A - POR DISCIPLINA</button>
                <button class="btn-azul" onclick="alert('Exportando Relatório por Turma...')">B - POR TURMA</button>
                <button class="btn-azul" onclick="alert('Exportando Semanal Professor...')">C - SEMANAL PROFESSOR</button>
                <button class="btn-azul" onclick="alert('Exportando Semanal Turma...')">D - SEMANAL TURMA</button>
            </div>
        </div>
    </section>
</main>

<script>
    // MOTOR DE DADOS DO SGH-IFRO
    let DB = JSON.parse(localStorage.getItem('SGH_IFRO_CORE')) || {};
    let ANO = "2026";

    const HORARIOS = [
        "07:30 - 08:20", "08:20 - 09:10", "INTERVALO", "09:30 - 10:20", "10:20 - 11:10", "11:10 - 12:00", 
        "ALMOÇO", "13:50 - 14:40", "14:40 - 15:30", "INTERVALO", "15:50 - 16:40", "16:40 - 17:30", "17:30 - 18:20", 
        "JANTAR", "19:00 - 19:50", "19:50 - 20:40", "INTERVALO", "20:50 - 21:40", "21:40 - 22:30"
    ];

    const RESTS = ["Manhã Inteira", "Tarde Inteira", "Noite Inteira", "1ª Aula Manhã", "Última Aula Manhã", "1ª Aula Tarde", "Última Aula Tarde"];

    function trocarAno() {
        ANO = document.getElementById('global-ano').value;
        if (!DB[ANO]) DB[ANO] = { inst:{}, profs:[], turmas:[], discs:[], vincs:[], feriados:[], sabados:[] };
        renderAll();
    }

    function showTab(idx) {
        document.querySelectorAll('.tab-content').forEach((el, i) => el.classList.toggle('hidden', i !== idx));
        if(idx === 1) renderMatrizRestricoes();
        if(idx === 5) renderGrade('grade-base-tec', 'Tecnico');
        if(idx === 6) renderGrade('grade-base-sup', 'Superior');
    }

    // --- MATRIZ DE RESTRIÇÕES (COMANDO 2) ---
    function renderMatrizRestricoes() {
        const body = document.getElementById('p-matriz-corpo');
        body.innerHTML = RESTS.map(r => `
            <tr><td>Não trabalhar ${r}</td>
            ${[0,1,2,3,4].map(d => `<td><input type="checkbox" class="p-rest-ck" data-dia="${d}" data-tipo="${r}"></td>`).join('')}
            </tr>`).join('');
    }

    // --- CADASTROS ---
    function salvarProfessor() {
        const p = {
            nome: document.getElementById('p-nome').value,
            siape: document.getElementById('p-siape').value,
            situacao: document.getElementById('p-sit').value,
            ch: document.getElementById('p-ch').value,
            pgd: document.getElementById('p-pgd-check').checked ? document.getElementById('p-pgd-val').value : 0,
            rests: Array.from(document.querySelectorAll('.p-rest-ck:checked')).map(c => ({dia: c.dataset.dia, tipo: c.dataset.tipo}))
        };
        DB[ANO].profs.push(p);
        persistir();
    }

    function salvarTurma() {
        DB[ANO].turmas.push({ nome: document.getElementById('t-nome').value, situacao: document.getElementById('t-sit').value, sala: document.getElementById('t-sala').value });
        persistir();
    }

    function salvarDisciplina() {
        DB[ANO].discs.push({ nome: document.getElementById('d-nome').value, situacao: document.getElementById('d-sit').value });
        persistir();
    }

    // --- VINCULAÇÃO (COMANDO 5E - LÓGICA DE AULAS) ---
    function gerarOpcoesAulas() {
        const ch = parseInt(document.getElementById('v-ch').value);
        const tIdx = document.getElementById('v-turma').value;
        if(!ch || tIdx === "") return;
        
        const tipo = DB[ANO].turmas[tIdx].situacao;
        const aulasSemana = (tipo === 'Tecnico') ? (ch / 40) : (ch / 20);
        const sel = document.getElementById('v-opcoes');
        sel.innerHTML = "";

        const map = { 1:["1 aula"], 2:["2 aulas"], 3:["2+1 aulas", "3 aulas"], 4:["2+2 aulas"], 5:["3+2 aulas"], 6:["3+3 aulas"] };
        (map[aulasSemana] || []).forEach(o => sel.innerHTML += `<option>${o}</option>`);
    }

    // --- GRADE HORÁRIA (COMANDO 6) ---
    function renderGrade(id, tipo) {
        const turmas = (DB[ANO].turmas || []).filter(t => t.situacao === tipo);
        let h = `<table class="excel-table"><thead><tr><th>Horário</th>`;
        turmas.forEach(t => h += `<th>${t.nome} (Sala ${t.sala})</th>`);
        h += `</tr></thead><tbody>`;
        
        HORARIOS.forEach(hr => {
            h += `<tr><td class="h-label">${hr}</td>`;
            turmas.forEach(t => {
                const isBreak = hr === "INTERVALO" || hr === "ALMOÇO" || hr === "JANTAR";
                h += `<td class="${isBreak ? 'break-cell' : 'drop-zone'}"></td>`;
            });
            h += `</tr>`;
        });
        document.getElementById(id).innerHTML = h + `</tbody></table>`;
    }

    function persistir() {
        localStorage.setItem('SGH_IFRO_CORE', JSON.stringify(DB));
        renderAll();
        alert("Dados salvos no pente fino!");
    }

    function renderAll() {
        const d = DB[ANO];
        // Popula listas de visualização
        document.getElementById('p-lista').innerHTML = "<b>Profs:</b> " + d.profs.map(p => p.nome).join(', ');
        document.getElementById('t-lista').innerHTML = "<b>Turmas:</b> " + d.turmas.map(t => t.nome).join(', ');
        document.getElementById('d-lista').innerHTML = "<b>Discs:</b> " + d.discs.map(disc => disc.nome).join(', ');
        
        // Popula selects de vinculação
        document.getElementById('v-prof').innerHTML = d.profs.map((p,i) => `<option value="${i}">${p.nome}</option>`).join('');
        document.getElementById('v-turma').innerHTML = d.turmas.map((t,i) => `<option value="${i}">${t.nome}</option>`).join('');
        document.getElementById('v-uniao-turma').innerHTML = d.turmas.map((t,i) => `<option value="${i}">${t.nome}</option>`).join('');
        document.getElementById('v-disc').innerHTML = d.discs.map((disc,i) => `<option value="${i}">${disc.nome}</option>`).join('');
    }

    window.onload = trocarAno;
</script>
</body>
</html>
